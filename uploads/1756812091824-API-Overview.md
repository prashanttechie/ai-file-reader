# Prompt Management API - Overview

## üìã **API Specification Overview**

This document provides a comprehensive overview of the Prompt Management API, a robust system for managing prompts, templates, and complex workflow orchestration with lifecycle management, versioning, composition, and advanced chaining capabilities.

### **üèóÔ∏è Structured Organization**
The specification is organized into logical sections:

1. **Prompt Management** - Core CRUD operations
2. **Chat Prompts** - Message-based prompt handling  
3. **Composition** - Multi-prompt combination
4. **Chains** - Advanced workflow orchestration
5. **Lifecycle** - Promotion and approval workflows
6. **Reviews** - User feedback system
7. **Templates** - Reusable prompt templates
8. **Health** - System monitoring

---

## üîó **Key API Endpoints**

### **Core Prompt Operations**
```
POST   /prompts                    # Create new prompt
GET    /prompts                    # List all prompts (with filtering)
GET    /prompts/{promptId}         # Get specific prompt
PUT    /prompts/{promptId}         # Update prompt
DELETE /prompts/{promptId}         # Delete prompt
```

### **Chat Prompts**
```
POST   /prompts/chat               # Create chat-based prompt
```

### **Prompt Composition**
```
POST   /prompts/compose            # Compose from multiple sources
```

### **Advanced Chaining**
```
POST   /chains                     # Create prompt chain
GET    /chains                     # List chains
GET    /chains/{chainId}           # Get specific chain
POST   /chains/{chainId}/execute   # Execute chain workflow
```

### **Lifecycle Management**
```
POST   /prompts/{name}/promote     # Promote to next stage
DELETE /prompts/{name}/approve     # Remove approval requirement
```

### **Review System**
```
POST   /prompts/{name}/reviews     # Submit review
GET    /prompts/{name}/reviews     # Get reviews
```

### **Templates**
```
POST   /templates                  # Create template
GET    /templates                  # List templates
GET    /templates/{id}             # Get template
POST   /templates/{id}/render      # Render with variables
```

---

## üîê **Security & Authentication**

### **Authentication Methods**
- **Bearer Token (JWT)** - Primary authentication for user sessions
- **API Key** - Service-to-service authentication

### **Security Schemes**
```yaml
securitySchemes:
  bearerAuth:
    type: http
    scheme: bearer
    bearerFormat: JWT
  apiKeyAuth:
    type: apiKey
    in: header
    name: X-API-Key
```

---

## üìä **Advanced Features**

### **1. Comprehensive Filtering**

#### **Query Parameters for Prompts**
- **Basic Filters**: `name`, `label`, `tag`, `category`, `useCase`
- **Metadata Filters**: `language`, `provider`, `author`
- **Date Range**: `fromUpdatedAt`, `toUpdatedAt`
- **Pagination**: `page`, `limit`

#### **Example Query**
```
GET /prompts?category=customer-interaction&tag=support&page=1&limit=20
```

### **2. Lifecycle Stages**

#### **Progression Path**
```
Draft ‚Üí InExperiment ‚Üí Ready
```

#### **Stage Characteristics**
- **Draft**: Newly created, no experimentation
- **InExperiment**: Being tested and optimized
- **Ready**: Verified and production-ready

#### **Approval Workflow**
- Automated promotion between stages
- GitHub integration for approval processes
- Tag-based management system

### **3. Prompt Chaining**

#### **Complex Workflow Orchestration**

##### **Step Types**
- **prompt**: Execute a single prompt
- **template**: Render a template with variables
- **condition**: Branching logic based on conditions
- **loop**: Iterate over array data
- **data_mapping**: Transform data between steps

##### **Execution Modes**
- **Sequential**: Steps execute in order
- **Parallel**: Independent steps run simultaneously

##### **Data Flow Features**
- **Dependencies**: Step-by-step ordering
- **Data Mapping**: Variable transformation between steps
- **Context Preservation**: Maintain state across execution

#### **Example Chain Structure**
```json
{
  "name": "customer-onboarding-flow",
  "executionMode": "sequential",
  "steps": [
    {
      "id": "step_welcome",
      "type": "template",
      "config": {"templateId": "welcome-template"},
      "dependencies": [],
      "dataMapping": {
        "recipient.name": "input.customerName"
      }
    },
    {
      "id": "step_verification",
      "type": "condition",
      "config": {
        "condition": "input.emailVerified === true"
      },
      "dependencies": ["step_welcome"]
    }
  ]
}
```

### **4. Template System**

#### **Features**
- **Variable Definitions**: Typed variables with validation
- **Multiple Formats**: text, HTML, markdown rendering
- **Reusable Components**: Template inheritance and composition

#### **Variable Definition**
```json
{
  "variables": [
    {
      "name": "customerName",
      "type": "string",
      "required": true,
      "description": "Customer's full name"
    },
    {
      "name": "priority",
      "type": "string",
      "required": false,
      "defaultValue": "medium"
    }
  ]
}
```

### **5. Review & Rating System**

#### **Capabilities**
- **User Feedback Collection**: Comments and structured feedback
- **Rating System**: 1-5 star ratings with aggregation
- **Review Analytics**: Average ratings and review counts
- **Metadata Tracking**: Author, timestamps, provider information

#### **Review Structure**
```json
{
  "promptName": "customer-greeting-prompt",
  "comment": "Works well for customer interactions",
  "provider": "langfuse",
  "rating": 4,
  "author": "john.doe@company.com"
}
```

---

## üìã **Schema Highlights**

### **Comprehensive Data Models**
- **35+ schemas** covering all data structures
- **Reusable components** for consistency across endpoints
- **Validation rules** and constraints for data integrity
- **Example data** for clear documentation

### **Error Handling**

#### **Standardized Error Responses**
- `400` - Bad Request (validation errors)
- `401` - Unauthorized (authentication required)
- `404` - Not Found (resource doesn't exist)
- `409` - Conflict (duplicate resources)
- `500` - Internal Server Error

#### **Error Response Format**
```json
{
  "error": "VALIDATION_ERROR",
  "message": "Invalid request parameters",
  "details": [
    {
      "field": "name",
      "message": "Name is required"
    }
  ],
  "timestamp": "2025-01-20T10:30:00.000Z",
  "requestId": "req_abc123"
}
```

### **Rich Metadata Support**

#### **Prompt Metadata Structure**
```yaml
metadata:
  modelRecommendation: "gpt-4"
  maxTokens: 150
  temperature: 0.7
  topP: 0.9
  tone: "professional"
  priority: "high"
  audience: "customer-support-agents"
  estimatedTokens: 120
  responseStyle: "conversational"
```

---

## üéØ **Key Improvements Over Draft**

### **1. Proper REST Design**
- Consistent HTTP methods and status codes
- Resource-based URL structure
- Appropriate use of HTTP verbs

### **2. Comprehensive Schemas**
- Detailed request/response models
- Type safety and validation
- Clear field descriptions

### **3. Advanced Filtering**
- Rich query capabilities
- Multiple filter combinations
- Date range filtering

### **4. Error Standardization**
- Consistent error format across all endpoints
- Detailed validation error messages
- Request tracking for debugging

### **5. Security Integration**
- Multiple authentication methods
- Proper security scheme definitions
- Authorization requirements per endpoint

### **6. Documentation**
- Detailed descriptions and examples
- Clear operation summaries
- Comprehensive schema documentation

### **7. Validation Rules**
- Required field specifications
- Data type constraints
- Business rule enforcement

---

## üîÑ **Workflow Examples**

### **Basic Prompt Creation Workflow**
```
1. POST /prompts (create with "draft" label)
2. POST /prompts/{name}/promote (Draft ‚Üí InExperiment)
3. POST /prompts/{name}/reviews (collect feedback)
4. POST /prompts/{name}/promote (InExperiment ‚Üí Ready)
5. DELETE /prompts/{name}/approve (remove approval requirement)
```

### **Complex Chain Execution**
```
1. POST /chains (create workflow definition)
2. POST /chains/{id}/execute (execute with input data)
3. Monitor execution status and step results
4. Handle errors and retry logic
```

### **Template-Based Composition**
```
1. POST /templates (create reusable template)
2. POST /prompts/compose (combine templates and text)
3. GET /templates/{id}/render (render with variables)
```

---

## üìÅ **File Structure**

### **API Specification**
```
/prompt-adapter-ts/api-specification.yaml    # Complete OpenAPI 3.0 spec
```

### **Request/Response Examples**
```
/request-response-doc/
‚îú‚îÄ‚îÄ single-prompt-request.json
‚îú‚îÄ‚îÄ single-prompt-response.json
‚îú‚îÄ‚îÄ single-prompt-template-request.json
‚îú‚îÄ‚îÄ Single-Prompt-template-response.json
‚îú‚îÄ‚îÄ single-prompt-chain-request.json
‚îú‚îÄ‚îÄ Single-Prompt-chain-response.json
‚îî‚îÄ‚îÄ generic-error-response-format.json
```

---

## üöÄ **Usage & Integration**

### **Interactive Documentation**
The OpenAPI specification can be used with:
- **Swagger UI** - Interactive API documentation
- **Postman** - API testing and collection generation
- **Insomnia** - REST client integration

### **Code Generation**
Generate client libraries and server stubs:
- **Client SDKs** - JavaScript, Python, Java, etc.
- **Server Stubs** - Express.js, Spring Boot, etc.
- **Type Definitions** - TypeScript interfaces

### **Testing & Validation**
- **Contract Testing** - Ensure API compliance
- **Mock Servers** - Development and testing
- **Request Validation** - Runtime validation

### **Monitoring & Observability**
Built-in health check endpoints:
```
GET /health                          # System health status
```

Health response includes:
- Service status (healthy/unhealthy/degraded)
- Dependency health (database, Langfuse, Redis)
- Performance metrics (response times, uptime)

---

## üìû **Support & Contact**

### **API Team**
- **Email**: prompt-team@company.com
- **Documentation**: Available via Swagger UI
- **License**: MIT

### **Getting Started**
1. Review the API specification (`api-specification.yaml`)
2. Set up authentication (JWT or API Key)
3. Start with basic prompt operations
4. Explore advanced features (chaining, composition)
5. Integrate review and lifecycle management

---

*This API specification is production-ready and follows OpenAPI 3.0 best practices with comprehensive coverage of all prompt management functionality.*
